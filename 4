CREATE TABLE BRANCH
(BRANCH_NAME VARCHAR(20) PRIMARY KEY,
BRANCH_CITY VARCHAR(10),
ASSETS REAL);

CREATE TABLE ACCOUNT
(ACCNO INT PRIMARY KEY,
BRANCH_NAME VARCHAR(20),
BALANCE REAL,
FOREIGN KEY(BRANCH_NAME) REFERENCES BRANCH(BRANCH_NAME));

CREATE TABLE CUSTOMER
(CUSTOMER_NAME VARCHAR(20) PRIMARY KEY,
CUSTOMER_STREET VARCHAR(20),
CUST_CITY VARCHAR(20));

CREATE TABLE DEPOSITOR
(CUSTOMER_NAME VARCHAR(20),
ACCNO INT,
PRIMARY KEY(CUSTOMER_NAME,ACCNO),
FOREIGN KEY(CUSTOMER_NAME) REFERENCES CUSTOMER(CUSTOMER_NAME),
FOREIGN KEY(ACCNO) REFERENCES ACCOUNT(ACCNO)ON DELETE CASCADE);

CREATE TABLE LOAN
(LOAN_NO INT PRIMARY KEY, 
 BRANCH_NAME VARCHAR(20),
 AMOUNT REAL,
 FOREIGN KEY(BRANCH_NAME) REFERENCES BRANCH(BRANCH_NAME));

CREATE TABLE BORROWER
(CUSTOMER_NAME VARCHAR(20),
LOAN_NO INT, 
FOREIGN KEY(CUSTOMER_NAME) REFERENCES CUSTOMER(CUSTOMER_NAME),
FOREIGN KEY(LOAN_NO) REFERENCES LOAN(LOAN_NO));


INSERT INTO BRANCH VALUES('NOVA','MANGALORE',10000);
INSERT INTO BRANCH VALUES('GEROGEPOL','ERANGEL',20000);
INSERT INTO BRANCH VALUES('FARM','BRIDGE',30000);
INSERT INTO BRANCH VALUES('LUMBERYARD','LIVIK',30000);
INSERT INTO BRANCH VALUES('CAVE','SHANHOK',20000);
INSERT INTO BRANCH VALUES('MAIN SBI VIJAY NAGAR','BANGALORE' ,20000);
INSERT INTO BRANCH VALUES('VIVEK NAGAR','BANGALORE' ,20000);
INSERT INTO BRANCH VALUES('KITHAGNUR','BANGALORE' ,20000);
INSERT INTO BRANCH VALUES('SUBHASH NAGAR','BANGALORE' ,20000);

INSERT INTO CUSTOMER VALUES ( 'KIRAN', 'REVANNA STREET', 'BANGALORE');
INSERT INTO ACCOUNT VALUES(019,'SUBHASH NAGAR',150000);
INSERT INTO ACCOUNT VALUES(018,'KITHAGNUR',150000);
INSERT INTO ACCOUNT VALUES(017,'VIVEK NAGAR',150000);
INSERT INTO ACCOUNT VALUES(016,'MAIN SBI VIJAY NAGAR',150000);
INSERT INTO ACCOUNT VALUES(015,'MAIN SBI VIJAY NAGAR',500000);
INSERT INTO ACCOUNT VALUES(014,'MAIN SBI VIJAY NAGAR',300000);
INSERT INTO ACCOUNT VALUES(013,'FARM',300000);
INSERT INTO ACCOUNT VALUES(012,'GEROGEPOL',200000);
INSERT INTO ACCOUNT VALUES(011,'NOVA',100000);

INSERT INTO CUSTOMER VALUES ( 'REVANNA', 'A STREET', 'BANGALORE');
INSERT INTO CUSTOMER VALUES ( 'KIRAN', 'REVANNA STREET', 'BANGALORE');
INSERT INTO CUSTOMER VALUES ( 'SHAKTHI', 'D STREET', 'BANGALORE');
INSERT INTO CUSTOMER VALUES ( 'AKASH', 'C STREET', 'BANGALORE');
INSERT INTO CUSTOMER VALUES ( 'R L K', 'B STREET', 'BANGALORE');

INSERT INTO DEPOSITOR VALUES('SHAKTHI',011);
INSERT INTO DEPOSITOR VALUES('AKASH',011);
INSERT INTO DEPOSITOR VALUES('R L K',011);
INSERT INTO DEPOSITOR VALUES('REVANNA',011);
INSERT INTO DEPOSITOR VALUES('KIRAN',011);
INSERT INTO DEPOSITOR VALUES('KIRAN',019);
INSERT INTO DEPOSITOR VALUES('AKASH',019);
INSERT INTO DEPOSITOR VALUES('AKASH',015);
INSERT INTO DEPOSITOR VALUES('AKASH',016);
INSERT INTO DEPOSITOR VALUES('AKASH',017);
INSERT INTO DEPOSITOR VALUES('AKASH',018);

INSERT INTO LOAN VALUES(7,'SUBHASH NAGAR', 10000);
INSERT INTO LOAN VALUES(6,'KITHAGNUR', 10000);
INSERT INTO LOAN VALUES(5,'VIVEK NAGAR', 10000);
INSERT INTO LOAN VALUES(4,'VIVEK NAGAR', 10000);
INSERT INTO LOAN VALUES(3,'MAIN SBI VIJAY NAGAR', 10000);
 
INSERT INTO LOAN VALUES(2,'MAIN SBI VIJAY NAGAR', 10000);
INSERT INTO LOAN VALUES(1,'MAIN SBI VIJAY NAGAR', 10000);
INSERT INTO BORROWER VALUES('KIRAN', 1);
INSERT INTO BORROWER VALUES('REVANNA', 2);
INSERT INTO BORROWER VALUES('R L K', 3);
INSERT INTO BORROWER VALUES('AKASH', 4);
INSERT INTO BORROWER VALUES('REVANNA', 5);


SELECT CUSTOMER_NAME 
FROM DEPOSITOR 
WHERE ACCNO IN(SELECT ACCNO 
FROM DEPOSITOR 
WHERE ACCNO IN( SELECT ACCNO 
FROM ACCOUNT 
WHERE BRANCH_NAME IN(SELECT BRANCH_NAME 
FROM ACCOUNT 
WHERE BRANCH_NAME='MAIN SBI VIJAY NAGAR' 
GROUP BY BRANCH_NAME 
HAVING COUNT(*) > 1) ))
GROUP BY CUSTOMER_NAME HAVING COUNT(*) > 1;


SELECT CUSTOMER_NAME 
FROM BRANCH B,ACCOUNT A,DEPOSITOR D 
WHERE B.BRANCH_NAME=A.BRANCH_NAME AND A.ACCNO=D.ACCNO AND
B.BRANCH_CITY='BANGALORE' GROUP BY CUSTOMER_NAME 
HAVING COUNT(DISTINCT B.BRANCH_NAME)=(SELECT COUNT(BRANCH_NAME) 
FROM BRANCH 
WHERE BRANCH_CITY='BANGALORE');


DELETE FROM ACCOUNT 
WHERE BRANCH_NAME IN (SELECT BRANCH_NAME 
FROM BRANCH 
WHERE BRANCH_CITY='BANGALORE');
